// Backend boundary data and point-in-polygon validation
// Mirrors the frontend goaBoundaries.ts for server-side enforcement

const GOA_BOUNDARIES = {
    "Tiswadi": [[15.54, 73.82], [15.52, 73.78], [15.49, 73.77], [15.46, 73.79], [15.44, 73.82], [15.45, 73.86], [15.47, 73.89], [15.50, 73.91], [15.52, 73.88], [15.54, 73.85], [15.54, 73.82]],
    "Bardez": [[15.62, 73.74], [15.59, 73.72], [15.55, 73.73], [15.52, 73.75], [15.51, 73.78], [15.52, 73.82], [15.54, 73.82], [15.57, 73.81], [15.59, 73.79], [15.61, 73.77], [15.62, 73.74]],
    "Pernem": [[15.75, 73.72], [15.73, 73.68], [15.70, 73.66], [15.66, 73.68], [15.63, 73.70], [15.61, 73.74], [15.62, 73.76], [15.65, 73.78], [15.69, 73.77], [15.72, 73.75], [15.75, 73.72]],
    "Bicholim": [[15.62, 73.96], [15.60, 73.92], [15.57, 73.89], [15.54, 73.88], [15.52, 73.90], [15.51, 73.94], [15.53, 73.98], [15.56, 74.00], [15.59, 73.99], [15.61, 73.98], [15.62, 73.96]],
    "Sattari": [[15.65, 74.10], [15.63, 74.06], [15.60, 74.02], [15.57, 74.00], [15.54, 74.01], [15.52, 74.04], [15.51, 74.08], [15.53, 74.12], [15.56, 74.14], [15.59, 74.13], [15.62, 74.12], [15.65, 74.10]],
    "Ponda": [[15.48, 74.02], [15.46, 73.98], [15.43, 73.96], [15.40, 73.97], [15.38, 74.00], [15.37, 74.04], [15.39, 74.07], [15.42, 74.08], [15.45, 74.06], [15.47, 74.04], [15.48, 74.02]],
    "Salcete": [[15.38, 73.88], [15.36, 73.85], [15.33, 73.83], [15.30, 73.84], [15.27, 73.86], [15.26, 73.89], [15.27, 73.92], [15.30, 73.95], [15.33, 73.96], [15.36, 73.94], [15.38, 73.91], [15.38, 73.88]],
    "Mormugao": [[15.42, 73.82], [15.40, 73.79], [15.38, 73.77], [15.36, 73.78], [15.35, 73.80], [15.36, 73.83], [15.38, 73.85], [15.40, 73.85], [15.41, 73.84], [15.42, 73.82]],
    "Quepem": [[15.28, 73.98], [15.26, 73.95], [15.23, 73.93], [15.20, 73.94], [15.18, 73.97], [15.17, 74.01], [15.19, 74.04], [15.22, 74.05], [15.25, 74.03], [15.27, 74.01], [15.28, 73.98]],
    "Canacona": [[15.05, 74.08], [15.03, 74.04], [15.00, 74.02], [14.97, 74.03], [14.95, 74.06], [14.94, 74.10], [14.96, 74.13], [14.99, 74.14], [15.02, 74.12], [15.04, 74.10], [15.05, 74.08]],
    "Sanguem": [[15.30, 74.12], [15.28, 74.08], [15.25, 74.05], [15.22, 74.06], [15.19, 74.09], [15.17, 74.13], [15.15, 74.17], [15.17, 74.20], [15.20, 74.21], [15.24, 74.19], [15.27, 74.16], [15.30, 74.12]],
    "Dharbandora": [[15.38, 74.12], [15.36, 74.08], [15.33, 74.06], [15.30, 74.07], [15.28, 74.10], [15.27, 74.14], [15.29, 74.17], [15.32, 74.18], [15.35, 74.16], [15.37, 74.14], [15.38, 74.12]]
};

/**
 * Ray-casting algorithm: check if (lat, lng) is inside a taluka boundary polygon
 */
function isPointInBoundary(lat, lng, taluka) {
    const polygon = GOA_BOUNDARIES[taluka];
    if (!polygon) return true; // No boundary defined â€” allow

    let inside = false;
    for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {
        const [yi, xi] = polygon[i];
        const [yj, xj] = polygon[j];
        const intersect = ((yi > lat) !== (yj > lat))
            && (lng < (xj - xi) * (lat - yi) / (yj - yi) + xi);
        if (intersect) inside = !inside;
    }
    return inside;
}

module.exports = { isPointInBoundary, GOA_BOUNDARIES };
