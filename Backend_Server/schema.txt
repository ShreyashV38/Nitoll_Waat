CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

CREATE TABLE areas (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    district TEXT NOT NULL,
    taluka TEXT NOT NULL,
    area_name TEXT NOT NULL
);

CREATE TABLE admins (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name TEXT NOT NULL,
    mobile TEXT UNIQUE NOT NULL,
    area_id UUID REFERENCES areas(id),
    vehicle_count INT DEFAULT 0
);

CREATE TABLE drivers (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name TEXT NOT NULL,
    mobile TEXT UNIQUE NOT NULL,
    area_id UUID REFERENCES areas(id)
);

CREATE TABLE bins (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    area_id UUID REFERENCES areas(id),
    latitude DOUBLE PRECISION NOT NULL,
    longitude DOUBLE PRECISION NOT NULL,
    is_active BOOLEAN DEFAULT TRUE
);

CREATE TABLE bin_readings (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    bin_id UUID REFERENCES bins(id) ON DELETE CASCADE,
    fill_percent INT CHECK (fill_percent BETWEEN 0 AND 100),
    weight DOUBLE PRECISION,
    status TEXT, 
    recorded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE bin_status (
    bin_id UUID PRIMARY KEY REFERENCES bins(id) ON DELETE CASCADE,
    current_fill INT CHECK (current_fill BETWEEN 0 AND 100),
    predicted_overflow_at TIMESTAMP,
    last_update TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    is_offline BOOLEAN DEFAULT FALSE,
    status TEXT 
);

CREATE TABLE alerts (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    area_id UUID REFERENCES areas(id),
    message TEXT NOT NULL,
    severity TEXT,
    is_read BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE vehicles ( id UUID PRIMARY KEY DEFAULT uuid_generate_v4(), area_id UUID REFERENCES areas(id), is_active BOOLEAN DEFAULT TRUE );
CREATE TABLE routes ( id UUID PRIMARY KEY DEFAULT uuid_generate_v4(), area_id UUID REFERENCES areas(id), route_date DATE NOT NULL, status TEXT DEFAULT 'PENDING' );
CREATE TABLE route_bins ( id UUID PRIMARY KEY DEFAULT uuid_generate_v4(), route_id UUID REFERENCES routes(id), bin_id UUID REFERENCES bins(id), sequence INT NOT NULL );